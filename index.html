<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MakeMyWay - Interface moderne plein √©cran pour la g√©n√©ration de parcours sportifs">
    <meta name="keywords" content="parcours running, course √† pied, g√©n√©rateur itin√©raire, sport, v√©lo, marche, carte plein √©cran">
    <meta name="author" content="MakeMyWay">
    <meta name="theme-color" content="#6366f1">
    
    <title>MakeMyWay - Interface Moderne</title>
    <!-- Cache bust: 2025-08-22-16:12 -->
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Police Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google Maps API sera charg√©e via script dynamique -->
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous">
    
    <!-- Favicon & PWA Icons -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <!-- Apple Touch Icon (PWA iOS) -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    
    <!-- Apple PWA Meta Tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="MakeMyWay">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#6366f1">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Styles CSS modulaires -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components/panel.css">
    <link rel="stylesheet" href="assets/css/components/main-controls.css">
    <link rel="stylesheet" href="assets/css/components/map.css">
    <link rel="stylesheet" href="assets/css/components/results.css">
    <link rel="stylesheet" href="assets/css/components/auth.css">
    <link rel="stylesheet" href="assets/css/components/fab.css">
    <link rel="stylesheet" href="assets/css/mobile-improvements.css">
    <link rel="stylesheet" href="assets/css/mobile-ux-simplified.css">
</head>
<body>
    <!-- Container principal avec carte plein √©cran -->
    <div class="app-container">
        <!-- Carte plein √©cran √©pur√©e -->
        <div id="map" class="map"></div>



        <!-- Header flottant -->
        <header class="floating-header">
            <div class="header-controls">
                <!-- Bouton Reset -->
                <button class="floating-btn reset-btn" id="resetBtn" title="Recommencer" style="display: none;">
                    <i class="fas fa-redo"></i>
                </button>
                
                <!-- Bouton Param√®tres unique -->
                <button class="floating-btn" id="settingsBtn" title="Param√®tres">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </header>

        <!-- Panel principal flottant -->
        <div class="main-panel" id="mainPanel">
            <div class="panel-handle"></div>
            <div class="panel-header">
                <h2 class="panel-title">
                    <i class="fas fa-route"></i>
                    Configuration du parcours
                </h2>
            </div>
            
            <div class="panel-content">
                <div class="panel-scrollable">
                
                <!-- Composant de recherche principal avec g√©olocalisation -->
                <div class="search-component-container">
                    <div class="search-bar-primary">
                        <div class="search-input-container">
                            <i class="fas fa-search search-icon"></i>
                            <span class="search-placeholder">O√π souhaitez-vous aller ?</span>
                            <input type="text" id="destinationAddress" class="search-input-primary" placeholder="O√π souhaitez-vous aller ?" value="" autocomplete="street-address" style="display: none;">
                        </div>
                    </div>
                    <button id="geoLocationBtnCollapsed" class="geolocation-btn-squircle" type="button" aria-label="Ma position">
                        <i class="fas fa-crosshairs"></i>
                    </button>
                </div>
                <div class="search-helper-text">Astuce : faites glisser vers le haut pour ouvrir les suggestions</div>

                <!-- S√©lecteur de type de parcours (divulgation progressive) -->
                <div class="route-type-selector" id="routeTypeSelector" style="display: none;">
                    <div class="route-type-header">
                        <label class="control-label">
                            <i class="fas fa-route"></i>
                            Type de parcours
                        </label>
                    </div>
                    <div class="route-type-buttons">
                        <button class="route-type-btn active" id="routeTypeLoop" data-type="loop">
                            <i class="fas fa-redo-alt"></i>
                            <span>Faire une boucle</span>
                        </button>
                        <button class="route-type-btn" id="routeTypeOneWay" data-type="oneway">
                            <i class="fas fa-arrow-right"></i>
                            <span>Aller-simple</span>
                        </button>
                    </div>
                </div>

                <!-- Contr√¥les principaux directement visibles -->
                <div class="main-controls">

                    <!-- Bloc Mode de d√©placement -->
                    <div class="section-block">
                        <div class="section-header">
                            <i class="fas fa-directions"></i>
                            <span class="section-title">Mode de d√©placement</span>
                        </div>
                        <div class="section-controls">
                            <div class="mode-cards">
                                <button class="mode-card active" data-mode="walking">
                                    <i class="fas fa-walking"></i>
                                    <span>Marche</span>
                                </button>
                                <button class="mode-card" data-mode="running">
                                    <i class="fas fa-running"></i>
                                    <span>Course</span>
                                </button>
                                <button class="mode-card" data-mode="cycling">
                                    <i class="fas fa-bicycle"></i>
                                    <span>V√©lo</span>
                                </button>
                            </div>
                            <!-- Hidden inputs for form compatibility -->
                            <input type="radio" id="mode-walking" name="travelMode" value="walking" class="segment-input" checked style="display: none;">
                            <input type="radio" id="mode-running" name="travelMode" value="running" class="segment-input" style="display: none;">
                            <input type="radio" id="mode-cycling" name="travelMode" value="cycling" class="segment-input" style="display: none;">
                        </div>
                    </div>

                    <!-- Bloc Ambiance du parcours -->
                    <div class="section-block">
                        <div class="section-header">
                            <i class="fas fa-palette"></i>
                            <span class="section-title">Ambiance du parcours</span>
                        </div>
                        <div class="section-controls">
                            <div class="chip-selector" id="theme-selector">
                                <button class="chip-button active" data-theme="default">üèÉ Libre</button>
                                <button class="chip-button" data-theme="nature">üå≥ Nature</button>
                                <button class="chip-button" data-theme="culture">üèõÔ∏è Culture</button>
                                <button class="chip-button" data-theme="urban">üèôÔ∏è Urbain</button>
                                <button class="chip-button" data-theme="sport">‚öΩ Sport</button>
                            </div>
                        </div>
                    </div>


                    <!-- Bloc Distance cible -->
                    <div class="section-block">
                        <div class="section-header">
                            <i class="fas fa-ruler-horizontal"></i>
                            <span class="section-title">Distance cible</span>
                        </div>
                        <div class="section-controls">
                            <div class="chip-selector distance-selector">
                                <button class="chip-button" data-distance="3">3 km</button>
                                <button class="chip-button active" data-distance="5">5 km</button>
                                <button class="chip-button" data-distance="8">8 km</button>
                                <button class="chip-button" data-distance="10">10 km</button>
                                <button class="chip-button custom" data-distance="custom">Personnalis√©</button>
                            </div>
                            
                            <!-- Slider personnalis√© (masqu√© par d√©faut) -->
                            <div class="distance-slider-custom" id="customDistanceSlider" style="display: none;">
                                <input type="range" id="targetDistance" class="slider" min="1" max="15" value="5" step="0.5">
                                <div class="slider-labels">
                                    <span>1km</span>
                                    <span id="maxLabel">15km</span>
                                </div>
                                <div class="distance-value-display" id="distanceValue">5 km</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Bloc Options avanc√©es (cliquable) -->
                <div class="section-block options-block" id="advancedOptionsBlock">
                    <div class="section-header clickable">
                        <i class="fas fa-sliders-h"></i>
                        <span class="section-title">Options avanc√©es</span>
                        <i class="fas fa-chevron-right section-chevron"></i>
                    </div>
                </div>

                <!-- Ancien accord√©on cach√© par d√©faut -->
                <div class="accordion-section" style="display: none;">
                    <button class="accordion-header">
                        <div class="accordion-title">
                            <i class="fas fa-sliders-h"></i>
                            Options avanc√©es
                        </div>
                    </button>
                    <div class="accordion-content">
                        <div class="accordion-body">
                            <!-- Point d'arriv√©e -->
                            <div class="input-group">
                                <label for="endAddress" class="input-label">Point d'arriv√©e (optionnel)</label>
                                <input type="text" id="endAddress" class="input" placeholder="Laissez vide pour un parcours en boucle" autocomplete="street-address">
                            </div>

                            <label class="switch-label">
                                <span class="switch">
                                    <input type="checkbox" id="returnToStart">
                                    <span class="switch-slider"></span>
                                </span>
                                Retour automatique au d√©part
                            </label>

                            <!-- Points d'int√©r√™t -->
                            <div class="poi-section">
                                <h4 class="subsection-title">Points d'int√©r√™t</h4>
                                <div class="poi-grid">
                                    <div class="poi-category" data-preset="nature" data-poi-type="park">
                                        <i class="fas fa-leaf poi-icon"></i>
                                        <span class="poi-name">Nature</span>
                                    </div>
                                    <div class="poi-category" data-preset="culture" data-poi-type="historic">
                                        <i class="fas fa-university poi-icon"></i>
                                        <span class="poi-name">Culture</span>
                                    </div>
                                    <div class="poi-category" data-preset="sport" data-poi-type="sport">
                                        <i class="fas fa-dumbbell poi-icon"></i>
                                        <span class="poi-name">Sport</span>
                                    </div>
                                    <div class="poi-category" data-preset="panorama" data-poi-type="tourism">
                                        <i class="fas fa-mountain poi-icon"></i>
                                        <span class="poi-name">Panorama</span>
                                    </div>
                                    <div class="poi-category" data-preset="eau" data-poi-type="leisure">
                                        <i class="fas fa-tint poi-icon"></i>
                                        <span class="poi-name">Points d'eau</span>
                                    </div>
                                    <div class="poi-category" data-preset="shopping" data-poi-type="shop">
                                        <i class="fas fa-shopping-bag poi-icon"></i>
                                        <span class="poi-name">Shopping</span>
                                    </div>
                                    <div class="poi-category" data-preset="cafe" data-poi-type="restaurant">
                                        <i class="fas fa-coffee poi-icon"></i>
                                        <span class="poi-name">Caf√©s</span>
                                    </div>
                                    <div class="poi-category" data-preset="entertainment" data-poi-type="entertainment">
                                        <i class="fas fa-music poi-icon"></i>
                                        <span class="poi-name">Divertissement</span>
                                    </div>
                                </div>

                                <div class="input-group">
                                    <label for="customPoi" class="input-label">Lieu personnalis√©</label>
                                    <div class="input-with-btn">
                                        <input type="text" id="customPoi" class="input" placeholder="Ex: Tour Eiffel, parc..." autocomplete="off">
                                        <button class="btn btn-secondary btn-sm" id="addPoiBtn">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                    <div class="poi-chips" id="poiChips"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                </div><!-- Fin panel-scrollable -->
                
                <!-- Barre d'action sticky -->
                <div class="panel-action-bar">
                    <button class="generate-route-btn" id="generateBtn" type="button">
                        <i class="fas fa-route"></i>
                        <span>G√©n√©rer le parcours</span>
                    </button>
                </div>
            </div>
        </div>


        <!-- FAB secondaire pour reset (appara√Æt apr√®s g√©n√©ration) -->
        <button class="fab-reset" id="resetBtn" style="display: none;" aria-label="Recommencer">
            <i class="fas fa-redo"></i>
        </button>

        <!-- Panel d'aide -->
        <div class="help-panel" id="helpPanel">
            <div class="help-header">
                <h3 class="help-title">
                    <i class="fas fa-lightbulb"></i>
                    Guide d'utilisation
                </h3>
                <button class="close-panel" id="closeHelp">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="help-tips">
                <div class="help-tip">
                    <i class="fas fa-mouse-pointer"></i>
                    <span><strong>Cliquer</strong> sur la carte pour placer les points de d√©part et d'arriv√©e</span>
                </div>
                <div class="help-tip">
                    <i class="fas fa-hand-rock"></i>
                    <span><strong>Glisser-d√©poser</strong> les marqueurs pour les repositionner</span>
                </div>
                <div class="help-tip">
                    <i class="fas fa-mouse"></i>
                    <span><strong>Clic droit</strong> sur un marqueur pour le supprimer</span>
                </div>
                <div class="help-tip">
                    <i class="fas fa-cog"></i>
                    <span><strong>Bouton param√®tres</strong> pour ouvrir la configuration du parcours</span>
                </div>
                <div class="help-tip">
                    <i class="fas fa-crosshairs"></i>
                    <span><strong>G√©olocalisation</strong> pour utiliser votre position actuelle</span>
                </div>
                <div class="help-tip">
                    <i class="fas fa-star"></i>
                    <span><strong>Points d'int√©r√™t</strong> pour enrichir votre parcours</span>
                </div>
            </div>
        </div>


        <!-- Panel de r√©sultats -->
        <div class="results-panel" id="resultsPanel">
            <div class="results-header">
                <div style="display: flex; align-items: center; gap: var(--space-3);">
                    <i class="fas fa-check-circle"></i>
                    <span>Parcours g√©n√©r√© !</span>
                </div>
                <button class="results-close" id="closeResults" title="Fermer">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="results-grid">
                <div class="result-stat">
                    <span class="stat-value" id="distanceResult">-</span>
                    <span class="stat-label">Distance</span>
                </div>
                <div class="result-stat">
                    <span class="stat-value" id="durationResult">-</span>
                    <span class="stat-label">Dur√©e</span>
                </div>
                <div class="result-stat">
                    <span class="stat-value" id="deviationResult">-</span>
                    <span class="stat-label">√âcart</span>
                </div>
            </div>
            
            <button class="btn btn-primary btn-full" id="exportBtn">
                <i class="fas fa-download"></i>
                Exporter GPX
            </button>
        </div>

        <!-- Loading overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <i class="fas fa-spinner loading-spinner"></i>
                <p>G√©n√©ration du parcours en cours...</p>
            </div>
        </div>

        <!-- Modal de connexion -->
        <div class="modal-overlay" id="loginModal">
            <div class="modal-container">
                <div class="modal-header">
                    <h3><i class="fas fa-sign-in-alt"></i> Connexion</h3>
                    <button class="modal-close" id="closeLogin">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-content">
                    <form id="loginForm">
                        <div class="input-group">
                            <label for="loginEmail" class="input-label">Email</label>
                            <input type="email" id="loginEmail" class="input" required autocomplete="email">
                        </div>
                        <div class="input-group">
                            <label for="loginPassword" class="input-label">Mot de passe</label>
                            <input type="password" id="loginPassword" class="input" required autocomplete="current-password">
                        </div>
                        <div class="modal-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt"></i>
                                Se connecter
                            </button>
                            <button type="button" class="btn btn-ghost" id="showRegister">
                                Pas de compte ? S'inscrire
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modal d'inscription -->
        <div class="modal-overlay" id="registerModal">
            <div class="modal-container">
                <div class="modal-header">
                    <h3><i class="fas fa-user-plus"></i> Inscription</h3>
                    <button class="modal-close" id="closeRegister">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-content">
                    <form id="registerForm">
                        <div class="input-group">
                            <label for="registerName" class="input-label">Nom</label>
                            <input type="text" id="registerName" class="input" required autocomplete="name">
                        </div>
                        <div class="input-group">
                            <label for="registerEmail" class="input-label">Email</label>
                            <input type="email" id="registerEmail" class="input" required autocomplete="email">
                        </div>
                        <div class="input-group">
                            <label for="registerPassword" class="input-label">Mot de passe</label>
                            <input type="password" id="registerPassword" class="input" required minlength="6" autocomplete="new-password">
                            <small class="input-help">Au moins 6 caract√®res</small>
                        </div>
                        <div class="modal-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-user-plus"></i>
                                S'inscrire
                            </button>
                            <button type="button" class="btn btn-ghost" id="showLogin">
                                D√©j√† un compte ? Se connecter
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Modale de gestion du compte -->
        <div class="modal-overlay" id="accountModal">
            <div class="modal-container">
                <div class="modal-header">
                    <h3>
                        <i class="fas fa-user-cog"></i>
                        Mon compte
                    </h3>
                    <button class="modal-close" id="closeAccount">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="modal-content">
                    <form id="accountForm">
                        <!-- Onglets -->
                        <div class="tabs">
                            <button type="button" class="tab-btn active" data-tab="profile">
                                <i class="fas fa-user"></i>
                                Profil
                            </button>
                            <button type="button" class="tab-btn" data-tab="password">
                                <i class="fas fa-lock"></i>
                                Mot de passe
                            </button>
                        </div>
                        
                        <!-- Contenu Profil -->
                        <div class="tab-content active" id="profileTab">
                            <div class="input-group">
                                <label for="accountName" class="input-label">Nom complet</label>
                                <input type="text" id="accountName" class="input" required minlength="2" autocomplete="name">
                            </div>
                            <div class="input-group">
                                <label for="accountEmail" class="input-label">Email</label>
                                <input type="email" id="accountEmail" class="input" required autocomplete="email">
                                <small class="input-help">L'email ne peut pas √™tre modifi√©</small>
                            </div>
                            <div class="input-group">
                                <label for="accountCreated" class="input-label">Membre depuis</label>
                                <input type="text" id="accountCreated" class="input" readonly>
                            </div>
                        </div>
                        
                        <!-- Contenu Mot de passe -->
                        <div class="tab-content" id="passwordTab">
                            <div class="input-group">
                                <label for="currentPassword" class="input-label">Mot de passe actuel</label>
                                <input type="password" id="currentPassword" class="input" required autocomplete="current-password">
                            </div>
                            <div class="input-group">
                                <label for="newPassword" class="input-label">Nouveau mot de passe</label>
                                <input type="password" id="newPassword" class="input" required minlength="6" autocomplete="new-password">
                                <small class="input-help">Au moins 6 caract√®res</small>
                            </div>
                            <div class="input-group">
                                <label for="confirmPassword" class="input-label">Confirmer le mot de passe</label>
                                <input type="password" id="confirmPassword" class="input" required minlength="6" autocomplete="new-password">
                            </div>
                        </div>
                        
                        <div class="modal-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Sauvegarder
                            </button>
                            <button type="button" class="btn btn-ghost" id="cancelAccount">
                                Annuler
                            </button>
                            <button type="button" class="btn btn-danger" id="deleteAccount">
                                <i class="fas fa-trash"></i>
                                Supprimer le compte
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Menu utilisateur maintenant dans header-controls -->
    </div>

    <!-- Scripts -->
    <!-- Fonction pont globale pour Google Maps -->
    <!-- Script pour supprimer les avertissements pendant le dev -->
    <script src="assets/js/suppress-warnings.js"></script>
    
    <script>
        /**
         * Fonction globale appel√©e par le callback Google Maps
         * Elle importe le module et lance l'initialisation
         */
        async function initMap() {
            try {
                console.log('üîó Callback Google Maps appel√©, importation du module...');
                
                // Importer le module principal
                const { initializeMakeMyWay } = await import('./assets/js/main.js');
                
                // Lancer l'initialisation
                await initializeMakeMyWay();
                
                console.log('‚úÖ Application initialis√©e via callback Google Maps');
                
            } catch (error) {
                console.error('‚ùå Erreur lors de l\'initialisation via callback Google Maps:', error);
                
                // Afficher une erreur utilisateur
                const errorMessage = document.createElement('div');
                errorMessage.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #fee2e2;
                    border: 1px solid #fecaca;
                    color: #991b1b;
                    padding: 1rem;
                    border-radius: 0.5rem;
                    z-index: 10000;
                    max-width: 500px;
                    text-align: center;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                `;
                errorMessage.innerHTML = `
                    <strong>‚ö†Ô∏è Erreur d'initialisation</strong><br>
                    <small>${error.message}</small><br>
                    <button onclick="window.location.reload()" style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; background: #dc2626; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">Recharger</button>
                `;
                document.body.appendChild(errorMessage);
            }
        }
    </script>
    
    <!-- Google Maps API avec les librairies places et geometry -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcwdJoblZLraZRdEndCxe35RhtlQaY8gQ&libraries=places,geometry&callback=initMap"></script>
    
    <!-- Application modulaire (charg√©e par le callback Google Maps) -->
    <!-- <script type="module" src="assets/js/main.js" defer></script> -->
    
    <!-- Conteneurs de suggestions pour l'autocompl√©tion -->
    <div id="startAddressSuggestions" class="suggestion-container"></div>
    <div id="endAddressSuggestions" class="suggestion-container"></div>
    <div id="poiSuggestions" class="suggestion-container"></div>
    
    <script>
        // Styles pour les conteneurs de suggestions
        const suggestionStyles = `
            .suggestion-container {
                position: absolute;
                background: white;
                border: 1px solid var(--border);
                border-radius: var(--radius-lg);
                box-shadow: var(--shadow-lg);
                z-index: 10000;
                max-height: 200px;
                overflow-y: auto;
                display: none;
            }
            
            .suggestion-item {
                padding: var(--space-3);
                cursor: pointer;
                border-bottom: 1px solid rgba(0,0,0,0.1);
                transition: background-color 0.2s ease;
            }
            
            .suggestion-item:hover {
                background-color: rgba(99, 102, 241, 0.1);
            }
            
            .suggestion-item:last-child {
                border-bottom: none;
            }
        `;
        
        // Injecter les styles
        const styleSheet = document.createElement('style');
        styleSheet.textContent = suggestionStyles;
        document.head.appendChild(styleSheet);
        
        console.log('üé® Interface h√©rit√©e initialis√©e - La nouvelle architecture modulaire prend le relais');
    </script>
</body>
</html>
