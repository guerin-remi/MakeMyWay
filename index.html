<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MakeMyWay - Interface moderne plein écran pour la génération de parcours sportifs">
    <meta name="keywords" content="parcours running, course à pied, générateur itinéraire, sport, vélo, marche, carte plein écran">
    <meta name="author" content="MakeMyWay">
    <meta name="theme-color" content="#6366f1">
    
    <title>MakeMyWay - Interface Moderne</title>
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    
    <!-- Police Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google Maps API sera chargée via script dynamique -->
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous">
    
    <!-- Favicon & PWA Icons -->
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    
    <!-- Apple Touch Icon (PWA iOS) -->
    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    
    <!-- Apple PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="MakeMyWay">
    
    <!-- Theme Color -->
    <meta name="theme-color" content="#6366f1">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Styles CSS modulaires -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components/panel.css">
    <link rel="stylesheet" href="assets/css/components/map.css">
    <link rel="stylesheet" href="assets/css/components/results.css">
</head>
<body>
    <!-- Container principal avec carte plein écran -->
    <div class="app-container">
        <!-- Carte plein écran -->
        <div id="map" class="map"></div>

        <!-- Contrôles de carte (zoom, etc.) -->
        <div class="map-controls">
            <button class="map-control-btn" id="zoomInBtn" title="Zoom avant">
                <i class="fas fa-plus"></i>
            </button>
            <button class="map-control-btn" id="zoomOutBtn" title="Zoom arrière">
                <i class="fas fa-minus"></i>
            </button>
            <button class="map-control-btn" id="centerMapBtn" title="Centrer sur le parcours">
                <i class="fas fa-crosshairs"></i>
            </button>
            <button class="map-control-btn" id="fullscreenBtn" title="Plein écran">
                <i class="fas fa-expand"></i>
            </button>
        </div>

        <!-- Header flottant -->
        <header class="floating-header">
            <div class="logo-bubble">
                <i class="fas fa-running"></i>
                <h1>MakeMyWay</h1>
            </div>
            <div class="header-controls">
                <button class="floating-btn" id="settingsBtn" title="Paramètres">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="floating-btn" id="helpBtn" title="Aide">
                    <i class="fas fa-question-circle"></i>
                </button>
            </div>
        </header>

        <!-- Panel principal flottant -->
        <div class="main-panel" id="mainPanel">
            <div class="panel-handle"></div>
            <div class="panel-header">
                <h2 class="panel-title">
                    <i class="fas fa-route"></i>
                    Configuration
                </h2>
                <button class="close-panel" id="closePanel">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="panel-content">
                <!-- Section Itinéraire -->
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Points du parcours
                    </h3>
                    
                    <div class="input-group">
                        <label for="startAddress" class="input-label">Point de départ</label>
                        <div class="input-with-btn">
                            <input type="text" id="startAddress" class="input" placeholder="Cliquez sur la carte ou saisissez une adresse">
                            <button class="btn btn-ghost btn-sm" id="useLocationBtn">
                                <i class="fas fa-crosshairs"></i>
                            </button>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="endAddress" class="input-label">Point d'arrivée (optionnel)</label>
                        <input type="text" id="endAddress" class="input" placeholder="Laissez vide pour un parcours en boucle">
                    </div>

                    <label class="switch-label">
                        <span class="switch">
                            <input type="checkbox" id="returnToStart">
                            <span class="switch-slider"></span>
                        </span>
                        Retour automatique au départ
                    </label>
                </div>

                <!-- Section Paramètres -->
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-cogs"></i>
                        Paramètres du parcours
                    </h3>
                    
                    <div class="input-group">
                        <label class="input-label">Mode de déplacement</label>
                        <div class="toggle-group">
                            <div class="toggle-option">
                                <input type="radio" id="mode-walking" name="travelMode" value="walking" class="toggle-input" checked>
                                <label for="mode-walking" class="toggle-label">
                                    <i class="fas fa-walking toggle-icon"></i>
                                    <span>Marche</span>
                                </label>
                            </div>
                            <div class="toggle-option">
                                <input type="radio" id="mode-running" name="travelMode" value="running" class="toggle-input">
                                <label for="mode-running" class="toggle-label">
                                    <i class="fas fa-running toggle-icon"></i>
                                    <span>Course</span>
                                </label>
                            </div>
                            <div class="toggle-option">
                                <input type="radio" id="mode-cycling" name="travelMode" value="cycling" class="toggle-input">
                                <label for="mode-cycling" class="toggle-label">
                                    <i class="fas fa-bicycle toggle-icon"></i>
                                    <span>Vélo</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="input-group">
                        <div class="slider-header">
                            <label class="input-label">Distance cible</label>
                            <span class="slider-value" id="distanceValue">5 km</span>
                        </div>
                        <div class="slider-container">
                            <input type="range" id="targetDistance" class="slider" min="1" max="10" value="5" step="0.5">
                            <div class="slider-labels">
                                <span>1km</span>
                                <span id="maxLabel">10km</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Section POI -->
                <div class="section">
                    <h3 class="section-title">
                        <i class="fas fa-star"></i>
                        Points d'intérêt
                    </h3>
                    
                    <div class="poi-grid">
                        <div class="poi-category" data-preset="nature">
                            <i class="fas fa-leaf poi-icon"></i>
                            <span class="poi-name">Nature</span>
                        </div>
                        <div class="poi-category" data-preset="culture">
                            <i class="fas fa-university poi-icon"></i>
                            <span class="poi-name">Culture</span>
                        </div>
                        <div class="poi-category" data-preset="sport">
                            <i class="fas fa-dumbbell poi-icon"></i>
                            <span class="poi-name">Sport</span>
                        </div>
                        <div class="poi-category" data-preset="panorama">
                            <i class="fas fa-mountain poi-icon"></i>
                            <span class="poi-name">Panorama</span>
                        </div>
                        <div class="poi-category" data-preset="eau">
                            <i class="fas fa-tint poi-icon"></i>
                            <span class="poi-name">Points d'eau</span>
                        </div>
                        <div class="poi-category" data-preset="shopping">
                            <i class="fas fa-shopping-bag poi-icon"></i>
                            <span class="poi-name">Shopping</span>
                        </div>
                    </div>

                    <div class="input-group">
                        <label for="customPoi" class="input-label">Lieu personnalisé</label>
                        <div class="input-with-btn">
                            <input type="text" id="customPoi" class="input" placeholder="Ex: Tour Eiffel, parc...">
                            <button class="btn btn-secondary btn-sm" id="addPoiBtn">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        <div class="poi-chips" id="poiChips"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel d'aide -->
        <div class="help-panel" id="helpPanel">
            <div class="help-header">
                <h3 class="help-title">
                    <i class="fas fa-lightbulb"></i>
                    Guide d'utilisation
                </h3>
                <button class="close-panel" id="closeHelp">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="help-tips">
                <div class="help-tip">
                    <i class="fas fa-mouse-pointer"></i>
                    <span><strong>Cliquer</strong> sur la carte pour placer les points de départ et d'arrivée</span>
                </div>
                <div class="help-tip">
                    <i class="fas fa-hand-rock"></i>
                    <span><strong>Glisser-déposer</strong> les marqueurs pour les repositionner</span>
                </div>
                <div class="help-tip">
                    <i class="fas fa-mouse"></i>
                    <span><strong>Clic droit</strong> sur un marqueur pour le supprimer</span>
                </div>
                <div class="help-tip">
                    <i class="fas fa-cog"></i>
                    <span><strong>Bouton paramètres</strong> pour ouvrir la configuration du parcours</span>
                </div>
                <div class="help-tip">
                    <i class="fas fa-crosshairs"></i>
                    <span><strong>Géolocalisation</strong> pour utiliser votre position actuelle</span>
                </div>
                <div class="help-tip">
                    <i class="fas fa-star"></i>
                    <span><strong>Points d'intérêt</strong> pour enrichir votre parcours</span>
                </div>
            </div>
        </div>

        <!-- Boutons d'action flottants -->
        <div class="floating-actions">
            <button class="reset-btn" id="resetBtn" title="Réinitialiser">
                <i class="fas fa-refresh"></i>
            </button>
            <button class="action-btn" id="generateBtn">
                <i class="fas fa-play"></i>
                <span>Générer le parcours</span>
            </button>
        </div>

        <!-- Panel de résultats -->
        <div class="results-panel" id="resultsPanel">
            <div class="results-header">
                <div style="display: flex; align-items: center; gap: var(--space-3);">
                    <i class="fas fa-check-circle"></i>
                    <span>Parcours généré !</span>
                </div>
                <button class="results-close" id="closeResults" title="Fermer">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="results-grid">
                <div class="result-stat">
                    <span class="stat-value" id="distanceResult">-</span>
                    <span class="stat-label">Distance</span>
                </div>
                <div class="result-stat">
                    <span class="stat-value" id="durationResult">-</span>
                    <span class="stat-label">Durée</span>
                </div>
                <div class="result-stat">
                    <span class="stat-value" id="deviationResult">-</span>
                    <span class="stat-label">Écart</span>
                </div>
            </div>
            
            <button class="btn btn-primary btn-full" id="exportBtn">
                <i class="fas fa-download"></i>
                Exporter GPX
            </button>
        </div>

        <!-- Loading overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="loading-content">
                <i class="fas fa-spinner loading-spinner"></i>
                <p>Génération du parcours en cours...</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Fonction pont globale pour Google Maps -->
    <script>
        /**
         * Fonction globale appelée par le callback Google Maps
         * Elle importe le module et lance l'initialisation
         */
        async function initMap() {
            try {
                console.log('🔗 Callback Google Maps appelé, importation du module...');
                
                // Importer le module principal
                const { initializeMakeMyWay } = await import('./assets/js/main.js');
                
                // Lancer l'initialisation
                await initializeMakeMyWay();
                
                console.log('✅ Application initialisée via callback Google Maps');
                
            } catch (error) {
                console.error('❌ Erreur lors de l\'initialisation via callback Google Maps:', error);
                
                // Afficher une erreur utilisateur
                const errorMessage = document.createElement('div');
                errorMessage.style.cssText = `
                    position: fixed;
                    top: 20px;
                    left: 50%;
                    transform: translateX(-50%);
                    background: #fee2e2;
                    border: 1px solid #fecaca;
                    color: #991b1b;
                    padding: 1rem;
                    border-radius: 0.5rem;
                    z-index: 10000;
                    max-width: 500px;
                    text-align: center;
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                `;
                errorMessage.innerHTML = `
                    <strong>⚠️ Erreur d'initialisation</strong><br>
                    <small>${error.message}</small><br>
                    <button onclick="window.location.reload()" style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; background: #dc2626; color: white; border: none; border-radius: 0.25rem; cursor: pointer;">Recharger</button>
                `;
                document.body.appendChild(errorMessage);
            }
        }
    </script>
    
    <!-- Google Maps API avec les librairies places et geometry -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBcwdJoblZLraZRdEndCxe35RhtlQaY8gQ&libraries=places,geometry&callback=initMap"></script>
    
    <!-- Application modulaire (chargée par le callback Google Maps) -->
    <!-- <script type="module" src="assets/js/main.js" defer></script> -->
    
    <!-- Conteneurs de suggestions pour l'autocomplétion -->
    <div id="startAddressSuggestions" class="suggestion-container"></div>
    <div id="endAddressSuggestions" class="suggestion-container"></div>
    <div id="poiSuggestions" class="suggestion-container"></div>
    
    <script>
        // Styles pour les conteneurs de suggestions
        const suggestionStyles = `
            .suggestion-container {
                position: absolute;
                background: white;
                border: 1px solid var(--border);
                border-radius: var(--radius-lg);
                box-shadow: var(--shadow-lg);
                z-index: 10000;
                max-height: 200px;
                overflow-y: auto;
                display: none;
            }
            
            .suggestion-item {
                padding: var(--space-3);
                cursor: pointer;
                border-bottom: 1px solid rgba(0,0,0,0.1);
                transition: background-color 0.2s ease;
            }
            
            .suggestion-item:hover {
                background-color: rgba(99, 102, 241, 0.1);
            }
            
            .suggestion-item:last-child {
                border-bottom: none;
            }
        `;
        
        // Injecter les styles
        const styleSheet = document.createElement('style');
        styleSheet.textContent = suggestionStyles;
        document.head.appendChild(styleSheet);
        
        console.log('🎨 Interface héritée initialisée - La nouvelle architecture modulaire prend le relais');
    </script>
</body>
</html>
